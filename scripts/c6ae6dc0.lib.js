"use strict";angular.module("lib.filter",[]),angular.module("lib.directive",["lib.filter"]),angular.module("lib",["lib.directive"]),angular.module("lib.filter").filter("formatName",function(){return function(a,b){var c,d="Â ",e=function(a,b){for(var c="",e=0,f=a.length;f>e;e++){var g;g=angular.isString(a[e])?a[e]||d:angular.isString(a[e][b])?a[e][b]||d:d,c=e?c+", "+g:c+g}return c};return c=angular.isUndefined(a)?d:angular.isString(a)?a||d:angular.isString(b)&&!angular.isUndefined(a[b])&&angular.isString(a[b])?a[b]||d:angular.isArray(a)&&a.length?e(a,b):d}}),angular.module("lib.filter").filter("hasFocus",function(){return function(a,b,c,d,e){var f=!1;if(a){var g=a[b];(b===c||d&&0>c&&g[e]===d[e])&&(f=!0)}return f}}),angular.module("lib.filter").filter("selectedIndex",function(){return function(a,b,c){var d=-1;return a&&!angular.isUndefined(a[c])&&angular.forEach(b,function(b,e){-1==d&&b[c]==a[c]&&(d=e)}),d}}),angular.module("lib.directive").directive("arrayMaxlength",function(){return{require:"ngModel",restrict:"A",link:function(a,b,c,d){var e=function(b){var e=!1,f=a.$eval(c.arrayMaxlength),g=angular.isArray(b)||angular.isString(b)?b:[];return g.length<=f&&(e=!0),d.$setValidity("arrayMaxlength",e),b};d.$parsers.unshift(e),d.$formatters.unshift(e)}}}),angular.module("lib.directive").directive("sglkSelect",function(){return{templateUrl:"views/sglk-select.html",restrict:"A",replace:!0,scope:{options:"=",value:"=ngModel",textVar:"@",multiple:"=",maxlength:"=arrayMaxlength"},controller:["$scope","$filter","hasFocusFilter","selectedIndexFilter",function(a,b,c,d){var e=this;a.isMultiple=!1,a.opts=[],this.cloneOptionsFilter=function(a){var b=[];return angular.forEach(a,function(a){b.push({active:!1,value:a})}),b},a.opts=e.cloneOptionsFilter(a.options);var f=!0;a.$watch("options",function(b){a.opts=e.cloneOptionsFilter(b),a.value=f?a.value:null,f=!1},!0),this.syncValues=function(a,b){var c=angular.copy(b);return angular.forEach(c,function(b){b.active=!1,angular.forEach(a,function(a){b.active=angular.equals(b.value,a)?!0:b.active})}),c};a.$watch("value",function(b){a.opts=e.syncValues(b,a.opts)});var g=!0;a.$watch("maxlength",function(){a.value=g?a.value:null,g=!1},!0),a.show=!1,a.toggle=function(){a.show?a.hideDrop():a.showDrop()},a.hideDrop=function(){a.show=!1,a.focused=-1},a.showDrop=function(){a.isDisabled||(a.show=!0,a.value&&(a.focused=d(a.value,a.options,a.textVar)))},a.select=function(b){a.isMultiple?a.selectMulti(b):a.selectSimple(b)},a.selectSimple=function(b){a.opts[b]&&(a.value=a.opts[b].value),a.hideDrop()},this.getActiveFilter=function(a){var b=[];return angular.forEach(a,function(a){a.active&&b.push(a.value)}),b.length?b:null},a.selectMulti=function(b){if(a.opts[b]){var c=!1,d=parseInt(a.maxlength),f=angular.isArray(a.value)?a.value.length:0;(angular.isUndefined(a.maxlength)&&!a.opts[b].active||!angular.isUndefined(a.maxlength)&&d>f&&!a.opts[b].active)&&(c=!0),a.opts[b].active=c}a.value=e.getActiveFilter(a.opts)},a.focused=-1,a.hasFocus=function(b){return c(a.options,b,a.focused,a.value,a.textVar)},a.selectFocused=function(){a.select(a.options[a.focused])},a.focusNext=function(){a.focused=a.focused+1<a.options.length?a.focused+1:0},a.focusPrev=function(){a.focused=a.focused-1>=0?a.focused-1:a.options.length-1},a.keyDownHandler=function(b){switch(b.keyCode){case 27:b.preventDefault(),a.hideDrop();break;case 9:a.hideDrop();break;case 13:b.preventDefault(),a.show&&a.focused>-1?a.select(a.focused):a.show?a.hideDrop():a.showDrop();break;case 38:b.preventDefault(),a.focusPrev();break;case 40:b.preventDefault(),a.focusNext()}}}],link:function(a,b,c){a.isMultiple=!angular.isUndefined(c.multiple),a.isDisabled=!angular.isUndefined(c.disabled);var d=b.find(".dropSelect");a.$watch("options",function(){d.scrollTop(0)},!0)}}});